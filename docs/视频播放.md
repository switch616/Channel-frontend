明白，你希望我把你提供的两个文档内容整合成一个**清晰、完整、可参考的技术文档**，而不是改成组件代码。我给你整理如下：

---

# 抖音刷视频 + Vue-Plyr 视频播放组件技术方案

该方案整合了 **抖音式刷视频交互** 和 **基于 vue-plyr 的高性能视频播放组件** 的核心技术点，实现了上下滑动切换视频、视频封面模糊、播放控制、多分辨率、速度控制及播放上报等功能。

---

## 一、核心功能解析

### 1. 视频播放背景模糊效果

**实现思路**
通过「独立模糊封面层 + 滤镜处理 + 加载完成自动隐藏」实现，避免直接对动态视频加模糊，提升性能。

**关键代码示例**

* **结构层**

```html
<div v-if="poster && showPosterOverlay" 
     class="poster-overlay" 
     :style="{ backgroundImage: `url(${poster})` }"></div>
```

* **样式层**

```css
.poster-overlay {
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  filter: blur(28px) brightness(0.9) saturate(1.1);
  transform: scale(1.05);
  z-index: 1;
}
```

* **逻辑层**

```ts
const showPosterOverlay = ref(true);
const onCanPlay = () => {
  showPosterOverlay.value = false;
}
```

**技术亮点**

* 模糊仅作用于静态封面，避免视频流加滤镜造成性能压力。
* 使用 `scale(1.05)` 解决模糊边缘空白问题。
* 精准监听 `canplay` 事件，实现无缝视觉过渡。

---

### 2. 视频自适应缩放 + 工具栏固定布局

**实现思路**

* 视频容器固定宽高，视频内容通过 `object-fit` 自适应缩放。
* 工具栏基于容器绝对定位，不随视频内容缩放变化。

**关键代码示例**

```css
.plyr-host {
  width: 100%;
  height: 100%;
  position: relative;
}

::v-deep(video) {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

::v-deep(.plyr) {
  width: 100%;
  height: 100%;
  position: relative;
  z-index: 2;
  background: transparent;
}

::v-deep(.plyr__video-wrapper) {
  height: 100%;
  background: transparent !important;
}
```

**技术亮点**

* 使用 `object-fit: contain` 适配所有分辨率，保证视频不拉伸。
* 工具栏固定定位，布局稳定，不受视频缩放影响。
* `::v-deep` 穿透作用域样式，修改 Plyr 内部样式不污染全局。

---

### 3. 播放行为上报（防重复）

```ts
const hasReported = ref(false);
const onPlay = async () => {
  if (!hasReported.value && props.videoId) {
    await logVideoView({ video_id: props.videoId });
    hasReported.value = true;
  }
}
```

**技术亮点**

* 状态标记防重复上报。
* 异常捕获避免接口失败影响播放。

---

### 4. 多分辨率 + 播放速度自定义

```ts
const plyrOptions = {
  controls: ['play-large', 'play', 'progress', 'current-time', 'duration', 'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen'],
  settings: ['quality', 'speed'],
  speed: { selected: 1, options: [0.5, 0.75, 1, 1.25, 1.5, 2] },
  quality: { default: 720, options: [1080, 720] },
  i18n: { qualityLabel: { 1080: '1080P', 720: '720P' } }
}
```

**技术亮点**

* 用户可自由选择播放速度和分辨率。
* 支持本地化文案显示。
* 动态渲染 `source` 可实现无缝切换不同分辨率。

---

### 5. 视频加载优化

```html
<video
  :poster="poster"
  playsinline
  :autoplay="autoplay"
  preload="metadata"
  controls
>
```

* `preload="metadata"` 仅加载视频元信息，减少首屏等待。
* `playsinline` 避免移动端自动全屏。
* 原生 poster 封面保证首帧显示。

---

## 二、抖音式刷视频实现（Slot 架构）

### 1. 核心状态

* `videoList`：完整 Feed 视频列表
* `cursor`：当前播放视频在 Feed 中的位置
* `videoSlots`：页面中固定 3 个视频 Slot（prev、current、next）
* `videoRefs`：Slot 对应的视频 DOM 引用

**Slot 关键逻辑**

```ts
function syncSlots() {
  videoSlots.value[0].video = videoList.value[cursor.value - 1] ?? null;
  videoSlots.value[1].video = videoList.value[cursor.value] ?? null;
  videoSlots.value[2].video = videoList.value[cursor.value + 1] ?? null;
}
```

* DOM 永远只有 3 个元素，切换时只替换内容，提升性能。
* `current` Slot 播放视频，其余暂停并重置。

---

### 2. 视频切换动画

```css
.video-item {
  transition: transform 0.36s cubic-bezier(0.22,0.61,0.36,1),opacity 0.3s;
  transform: translateY(100%);
}
.video-item.active {
  opacity: 1;
  transform: translateY(0);
}
.video-item[data-type='prev'] { transform: translateY(-100%); }
.video-item[data-type='next'] { transform: translateY(100%); }
```

* 上下滑动时，prev/next Slot 移动到 current 位置。
* 保留 DOM，提高切换流畅度。

---

### 3. 鼠标滚轮 / 键盘控制

```ts
function onWheel(e: WheelEvent) {
  e.deltaY > 0 ? nextVideo() : prevVideo()
}
function handleKeydown(e: KeyboardEvent) {
  if (e.code === 'ArrowDown') nextVideo()
  if (e.code === 'ArrowUp') prevVideo()
}
```

* PC 支持上下箭头或滚轮刷视频。
* 移动端可替换为 touch 手势。

---

### 4. 评论模块（可选）

* 评论数据与视频播放解耦，通过 `videoId` 请求接口加载。
* 支持树状结构、回复、点赞等功能。

```ts
async function loadComments(videoId: number) {
  const res = await getVideoCommentTree(videoId);
  if (!res.success) return;
  comments.value = mapCommentTree(res.data);
}
```

---

## 三、核心技术总结

| 功能      | 核心方案                             | 技术优势        |
| ------- | -------------------------------- | ----------- |
| 视频背景模糊  | 静态封面 + filter: blur + canplay 隐藏 | 性能优、视觉自然    |
| 视频自适应缩放 | video + object-fit: contain      | 适配所有分辨率、无拉伸 |
| 工具栏固定布局 | 容器绝对定位 + 样式穿透                    | 布局稳定        |
| 播放行为上报  | 状态标记 + 异常捕获                      | 防重复、鲁棒性强    |
| 多分辨率/速度 | plyr 配置 + 动态 source              | 用户体验佳       |
| 抖音式刷视频  | Slot 架构 + 上下切换动画                 | DOM 恒定、切换流畅 |
| 视频加载优化  | preload="metadata" + playsinline | 首屏快、移动端适配   |

---

### 四、文件结构建议

* 组件：`src/components/video/VideoPlayer.vue`
* 页面：`src/views/video/VideoFeed.vue`
* API：`src/api/video.ts`
* 样式：Scoped CSS 或 Tailwind，根据 Slot 和 Plyr 定制

---